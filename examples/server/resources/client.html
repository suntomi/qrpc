<!doctype html>
<html>
  <head>
    <title>WebRTC with QRPC base</title>
  </head>
  <body>
    <script>
      const socket = io();

      const configuration = {'iceServers': [{'urls': 'stun:stun.l.google.com:19302'}]};
      const pc = new RTCPeerConnection(configuration);

      pc.onicecandidate = ({candidate}) => {
        socket.emit('ice-candidate', candidate);
      };

      pc.ondatachannel = (event) => {
        const receiveChannel = event.channel;
        receiveChannel.onmessage = (event) => {
          console.log('DataChannel message received:', event.data);
        };
      };

      socket.on('answer', (answer) => {
        console.log('answer:', answer);
        pc.setRemoteDescription(answer);
      });

      socket.on('ice-candidate', (candidate) => {
        console.log("candidate:", candidate);
        pc.addIceCandidate(candidate);
      });

      const dataChannel = pc.createDataChannel('myDataChannel');

      dataChannel.onopen = () => {
        setInterval(() => dataChannel.send('Hello Node.js'), 1000);
      };

      // Create an offer and send it to the Node.js server
      pc.createOffer()
        .then(offer => pc.setLocalDescription(offer))
        .then(() => socket.emit('offer', pc.localDescription));
    </script>
  </body>
</html>
